<div class="min-h-screen bg-gray-50 p-4">
  <!-- Header -->
  <header class="max-w-7xl mx-auto mb-8">
    <div class="text-center">
      <div class="flex items-center justify-center mb-4">
        <img src="/logo.png" alt="xTodo Logo" class="h-12 w-12 object-contain mr-3">
        <h1 class="text-4xl font-bold text-gray-900">xTodo</h1>
      </div>
      <p class="text-gray-600">Organize your tasks, achieve your goals</p>
    </div>
  </header>

  <!-- Statistics Cards -->
  <section class="max-w-7xl mx-auto mb-8" aria-label="Task statistics">
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4">
      <p-card class="text-center">
        <div class="p-4">
          <div class="text-2xl font-bold text-blue-600" aria-label="Total tasks count">{{ statistics.total || 0 }}</div>
          <div class="text-sm text-gray-600">Total Tasks</div>
        </div>
      </p-card>
      
      <p-card class="text-center">
        <div class="p-4">
          <div class="text-2xl font-bold text-green-600" aria-label="Active tasks count">{{ statistics.active || 0 }}</div>
          <div class="text-sm text-gray-600">Active</div>
        </div>
      </p-card>
      
      <p-card class="text-center">
        <div class="p-4">
          <div class="text-2xl font-bold text-purple-600" aria-label="Completed tasks count">{{ statistics.completed || 0 }}</div>
          <div class="text-sm text-gray-600">Completed</div>
        </div>
      </p-card>
      
      <p-card class="text-center">
        <div class="p-4">
          <div class="text-2xl font-bold text-orange-600" aria-label="Tasks due today count">{{ statistics.dueToday || 0 }}</div>
          <div class="text-sm text-gray-600">Due Today</div>
        </div>
      </p-card>
      
      <p-card class="text-center">
        <div class="p-4">
          <div class="text-2xl font-bold text-red-600" aria-label="Overdue tasks count">{{ statistics.overdue || 0 }}</div>
          <div class="text-sm text-gray-600">Overdue</div>
        </div>
      </p-card>
    </div>
  </section>

  <!-- Sync Controls -->
  <section class="max-w-7xl mx-auto mb-6" aria-label="Sync controls">
    <div class="flex justify-center space-x-4">
      <button 
        pButton 
        label="Sync with Server" 
        icon="pi pi-refresh"
        [loading]="isSyncing"
        (click)="syncWithServer()"
        class="p-button-success"
        [disabled]="isSyncing"
        aria-label="Synchronize tasks with server"
      ></button>
      
      <div *ngIf="pendingChanges > 0" class="flex items-center text-orange-600" role="status" aria-live="polite">
        <i class="pi pi-exclamation-triangle mr-2" aria-hidden="true"></i>
        <span>{{ pendingChanges }} pending changes</span>
      </div>
    </div>
  </section>

  <!-- Main Content -->
  <div class="max-w-7xl mx-auto">
    <div class="grid grid-cols-1 lg:grid-cols-4 gap-8">
      
      <!-- Left Sidebar - Filters -->
      <aside class="lg:col-span-1" aria-label="Task filters">
        <p-card header="Filters" class="h-fit">
          <!-- Search -->
          <div class="mb-4">
            <label for="task-search" class="block text-sm font-medium text-gray-700 mb-2">Search</label>
            <input 
              pInputText 
              type="text" 
              id="task-search"
              placeholder="Search tasks..."
              [(ngModel)]="filters.search"
              (input)="applyFilters()"
              class="w-full"
              aria-label="Search tasks by title or description"
            />
          </div>

          <!-- View Toggle -->
          <div class="mb-4">
            <fieldset>
              <legend class="block text-sm font-medium text-gray-700 mb-2">View</legend>
              <div class="flex flex-col space-y-2" role="group" aria-label="Task view options">
                <button 
                  *ngFor="let view of viewOptions"
                  (click)="setView(view)"
                  [class]="'text-left px-3 py-2 rounded-lg transition-colors ' + 
                           (selectedView === view ? 'bg-blue-100 text-blue-700' : 'hover:bg-gray-100')"
                  [attr.aria-pressed]="selectedView === view"
                  [attr.aria-label]="'Show ' + view + ' tasks'"
                >
                  {{ view | titlecase }}
                </button>
              </div>
            </fieldset>
          </div>

          <!-- Group by Project Toggle -->
          <div class="mb-4">
            <label class="block text-sm font-medium text-gray-700 mb-2">Display</label>
            <button 
              (click)="toggleProjectGrouping()"
              [class]="'w-full text-left px-3 py-2 rounded-lg transition-colors ' + 
                       (showProjectGroups ? 'bg-green-100 text-green-700' : 'hover:bg-gray-100')"
              [attr.aria-pressed]="showProjectGroups"
              aria-label="Toggle grouping tasks by project"
            >
              <i [class]="showProjectGroups ? 'pi pi-check-square' : 'pi pi-square'" class="mr-2" aria-hidden="true"></i>
              Group by Project
            </button>
          </div>

          <!-- Priority Filter -->
          <div class="mb-4">
            <label for="priority-filter" class="block text-sm font-medium text-gray-700 mb-2">Priority</label>
            <select 
              id="priority-filter"
              [(ngModel)]="filters.priority"
              (change)="applyFilters()"
              class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
              aria-label="Filter tasks by priority"
            >
              <option [value]="null">All Priorities</option>
              <option *ngFor="let priority of priorityOptions" [value]="priority.value">
                {{ priority.label }}
              </option>
            </select>
          </div>

          <!-- Project Filter -->
          <div class="mb-4">
            <label for="project-filter" class="block text-sm font-medium text-gray-700 mb-2">Project</label>
            <select 
              id="project-filter"
              [(ngModel)]="filters.projectId"
              (change)="applyFilters()"
              class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
              aria-label="Filter tasks by project"
            >
              <option [value]="null">All Projects</option>
              <option *ngFor="let project of projects" [value]="project.id">
                {{ project.name }}
              </option>
            </select>
          </div>

          <!-- Add Task Button -->
          <button 
            pButton 
            label="Add Task" 
            icon="pi pi-plus"
            (click)="showAddDialog = true"
            class="w-full"
            aria-label="Add a new task"
          ></button>
        </p-card>
      </aside>

      <!-- Right Content - Task List -->
      <div class="lg:col-span-3">
        <p-card header="Tasks" class="min-h-[600px]">
          <!-- Task List -->
          <div *ngIf="filteredTasks.length === 0" class="text-center py-12" role="status">
            <div class="text-gray-400 mb-4" aria-hidden="true">
              <i class="pi pi-inbox text-6xl"></i>
            </div>
            <h3 class="text-lg font-medium text-gray-900 mb-2">No tasks found</h3>
            <p class="text-gray-600">Create your first task to get started!</p>
          </div>

          <!-- Grouped View -->
          <div *ngIf="showProjectGroups && groupedTasks.length > 0">
            <div *ngFor="let group of groupedTasks" class="mb-6">
              <!-- Project Header -->
              <h2 class="flex items-center mb-3">
                <div 
                  *ngIf="group.project"
                  class="flex items-center space-x-2"
                >
                  <div 
                    class="w-4 h-4 rounded-full"
                    [style.background-color]="group.project.color"
                    aria-hidden="true"
                  ></div>
                  <span class="text-lg font-semibold text-gray-900">{{ group.project.name }}</span>
                  <span class="text-sm text-gray-500">({{ group.tasks.length }})</span>
                </div>
                <div *ngIf="!group.project" class="flex items-center space-x-2">
                  <i class="pi pi-inbox text-gray-400" aria-hidden="true"></i>
                  <span class="text-lg font-semibold text-gray-900">Unassigned Tasks</span>
                  <span class="text-sm text-gray-500">({{ group.tasks.length }})</span>
                </div>
              </h2>
              
              <!-- Tasks in this group -->
              <div *ngFor="let task of group.tasks" class="mb-4 last:mb-0 ml-6">
                <article class="border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow">
                  <div class="flex items-start space-x-3">
                    <!-- Checkbox -->
                    <p-checkbox 
                      [binary]="true"
                      [ngModel]="task.completed"
                      (onChange)="toggleTaskCompletion(task)"
                      class="mt-1"
                      [attr.aria-label]="'Mark task ' + task.title + ' as ' + (task.completed ? 'incomplete' : 'complete')"
                      [inputId]="'task-checkbox-grouped-' + task.id"
                    ></p-checkbox>

                    <!-- Task Content -->
                    <div class="flex-1 min-w-0">
                      <div class="flex items-start justify-between">
                        <div class="flex-1">
                          <h3 
                            [class]="'text-lg font-medium ' + (task.completed ? 'line-through text-gray-500' : 'text-gray-900')"
                          >
                            {{ task.title }}
                          </h3>
                          
                          <p 
                            *ngIf="task.description"
                            [class]="'text-sm mt-1 ' + (task.completed ? 'text-gray-400' : 'text-gray-600')"
                          >
                            {{ task.description }}
                          </p>

                          <!-- Task Meta -->
                          <div class="flex flex-wrap items-center gap-2 mt-3">
                            <!-- Priority -->
                            <span 
                              [class]="'px-2 py-1 text-xs font-medium rounded-full ' + getPriorityColor(task.priority)"
                              role="status"
                              [attr.aria-label]="task.priority + ' priority'"
                            >
                              {{ task.priority }}
                            </span>

                            <!-- Project -->
                            <span 
                              *ngIf="task.projectId"
                              [class]="'px-2 py-1 text-xs font-medium rounded-full ' + getProjectColor(task.projectId)"
                              role="status"
                              [attr.aria-label]="'Project: ' + getProjectName(task.projectId)"
                            >
                              {{ getProjectName(task.projectId) }}
                            </span>

                            <!-- Due Date -->
                            <span 
                              *ngIf="task.dueDate"
                              [class]="'px-2 py-1 text-xs font-medium rounded-full ' + 
                                       (isOverdue(task) ? 'bg-red-100 text-red-800' : 
                                        isDueToday(task) ? 'bg-blue-100 text-blue-800' : 
                                        'bg-gray-100 text-gray-600')"
                              role="status"
                              [attr.aria-label]="'Due ' + (task.dueDate | date:'shortDate') + (isOverdue(task) ? ' (Overdue)' : isDueToday(task) ? ' (Today)' : '')"
                            >
                              <i class="pi pi-calendar mr-1" aria-hidden="true"></i>
                              {{ task.dueDate | date:'shortDate' }}
                              <span *ngIf="isOverdue(task)" class="ml-1">(Overdue)</span>
                              <span *ngIf="isDueToday(task)" class="ml-1">(Today)</span>
                            </span>
                          </div>
                        </div>

                        <!-- Actions -->
                        <div class="flex items-center space-x-2 ml-4">
                          <button 
                            pButton 
                            icon="pi pi-trash" 
                            severity="danger"
                            size="small"
                            (click)="deleteTask(task)"
                            pTooltip="Delete task"
                            class="p-button-text"
                            [attr.aria-label]="'Delete task ' + task.title"
                          ></button>
                        </div>
                      </div>
                    </div>
                  </div>
                </article>
              </div>
            </div>
          </div>

          <!-- Flat View -->
          <div *ngIf="!showProjectGroups">
            <div *ngFor="let task of filteredTasks" class="mb-4 last:mb-0">
              <article class="border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow">
                <div class="flex items-start space-x-3">
                  <!-- Checkbox -->
                  <p-checkbox 
                    [binary]="true"
                    [ngModel]="task.completed"
                    (onChange)="toggleTaskCompletion(task)"
                    class="mt-1"
                    [attr.aria-label]="'Mark task ' + task.title + ' as ' + (task.completed ? 'incomplete' : 'complete')"
                    [inputId]="'task-checkbox-' + task.id"
                  ></p-checkbox>

                  <!-- Task Content -->
                  <div class="flex-1 min-w-0">
                    <div class="flex items-start justify-between">
                      <div class="flex-1">
                        <h3 
                          [class]="'text-lg font-medium ' + (task.completed ? 'line-through text-gray-500' : 'text-gray-900')"
                        >
                          {{ task.title }}
                        </h3>
                        
                        <p 
                          *ngIf="task.description"
                          [class]="'text-sm mt-1 ' + (task.completed ? 'text-gray-400' : 'text-gray-600')"
                        >
                          {{ task.description }}
                        </p>

                        <!-- Task Meta -->
                        <div class="flex flex-wrap items-center gap-2 mt-3">
                          <!-- Priority -->
                          <span 
                            [class]="'px-2 py-1 text-xs font-medium rounded-full ' + getPriorityColor(task.priority)"
                            role="status"
                            [attr.aria-label]="task.priority + ' priority'"
                          >
                            {{ task.priority }}
                          </span>

                          <!-- Project -->
                          <span 
                            *ngIf="task.projectId"
                            [class]="'px-2 py-1 text-xs font-medium rounded-full ' + getProjectColor(task.projectId)"
                            role="status"
                            [attr.aria-label]="'Project: ' + getProjectName(task.projectId)"
                          >
                            {{ getProjectName(task.projectId) }}
                          </span>

                          <!-- Due Date -->
                          <span 
                            *ngIf="task.dueDate"
                            [class]="'px-2 py-1 text-xs font-medium rounded-full ' + 
                                     (isOverdue(task) ? 'bg-red-100 text-red-800' : 
                                      isDueToday(task) ? 'bg-blue-100 text-blue-800' : 
                                      'bg-gray-100 text-gray-600')"
                            role="status"
                            [attr.aria-label]="'Due ' + (task.dueDate | date:'shortDate') + (isOverdue(task) ? ' (Overdue)' : isDueToday(task) ? ' (Today)' : '')"
                          >
                            <i class="pi pi-calendar mr-1" aria-hidden="true"></i>
                            {{ task.dueDate | date:'shortDate' }}
                            <span *ngIf="isOverdue(task)" class="ml-1">(Overdue)</span>
                            <span *ngIf="isDueToday(task)" class="ml-1">(Today)</span>
                          </span>
                        </div>
                      </div>

                      <!-- Actions -->
                      <div class="flex items-center space-x-2 ml-4">
                        <button 
                          pButton 
                          icon="pi pi-trash" 
                          severity="danger"
                          size="small"
                          (click)="deleteTask(task)"
                          pTooltip="Delete task"
                          class="p-button-text"
                          [attr.aria-label]="'Delete task ' + task.title"
                        ></button>
                      </div>
                    </div>
                  </div>
                </div>
              </article>
            </div>
          </div>
        </p-card>
      </div>
    </div>
  </div>

  <!-- Add Task Dialog -->
  <p-dialog 
    header="Add New Task" 
    [(visible)]="showAddDialog" 
    [modal]="true" 
    [style]="{width: '500px'}"
    [draggable]="false"
    [resizable]="false"
    aria-labelledby="add-task-dialog-title"
    role="dialog"
  >
    <div class="space-y-4">
      <!-- Title -->
      <div>
        <label for="new-task-title" class="block text-sm font-medium text-gray-700 mb-2">Title *</label>
        <input 
          pInputText 
          type="text" 
          id="new-task-title"
          placeholder="Enter task title..."
          [(ngModel)]="newTask.title"
          class="w-full"
          aria-required="true"
        />
      </div>

      <!-- Description -->
      <div>
        <label for="new-task-description" class="block text-sm font-medium text-gray-700 mb-2">Description</label>
        <textarea 
          pTextarea 
          id="new-task-description"
          placeholder="Enter task description..."
          [(ngModel)]="newTask.description"
          [rows]="3"
          class="w-full"
        ></textarea>
      </div>

      <!-- Priority -->
      <div>
        <label for="new-task-priority" class="block text-sm font-medium text-gray-700 mb-2">Priority</label>
        <select 
          id="new-task-priority"
          [(ngModel)]="newTask.priority"
          class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
          aria-label="Select task priority"
        >
          <option *ngFor="let priority of priorityOptions" [value]="priority.value">
            {{ priority.label }}
          </option>
        </select>
      </div>

      <!-- Due Date -->
      <div>
        <label for="new-task-duedate" class="block text-sm font-medium text-gray-700 mb-2">Due Date</label>
        <input 
          type="date"
          id="new-task-duedate"
          [(ngModel)]="newTask.dueDate"
          class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
          aria-label="Select task due date"
        />
      </div>

      <!-- Project -->
      <div>
        <label for="new-task-project" class="block text-sm font-medium text-gray-700 mb-2">Project</label>
        <select 
          id="new-task-project"
          [(ngModel)]="newTask.projectId"
          class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
          aria-label="Select task project"
        >
          <option [value]="null">No Project</option>
          <option *ngFor="let project of projects" [value]="project.id">
            {{ project.name }}
          </option>
        </select>
      </div>
    </div>

    <ng-template pTemplate="footer">
      <div class="flex justify-end space-x-2">
        <button 
          pButton 
          label="Cancel" 
          severity="secondary"
          (click)="showAddDialog = false"
          class="p-button-text"
          aria-label="Cancel adding task"
        ></button>
        <button 
          pButton 
          label="Add Task" 
          icon="pi pi-check"
          (click)="addTask()"
          aria-label="Add new task"
        ></button>
      </div>
    </ng-template>
  </p-dialog>

  <!-- Toast Messages -->
  <p-toast></p-toast>

  <!-- Confirmation Dialog -->
  <p-confirmDialog></p-confirmDialog>
</div>
